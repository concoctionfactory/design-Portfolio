var Project=Backbone.Model.extend({idAttribute:"url",defaults:function(){return{}}}),Projects=Backbone.Collection.extend({model:Project,url:"json/projects.json"}),ProjectView=Backbone.View.extend({tagName:"div",className:"project clickable",attributes:{},initialize:function(a){this.bus=a.bus},events:{"click img":"project_clicked"},project_clicked:function(a){router.navigate("projects/"+this.model.get("url"),{trigger:!0})},render:function(){var a=_.template($("#projectTemplate").html()),b=a(this.model.toJSON());return this.$el.html(b),this}}),ProjectsView=Backbone.View.extend({initialize:function(a){this.bus=a.bus},render:function(){var a=this;this.collection.each(function(b){var c=new ProjectView({model:b,bus:a.bus});a.$el.append(c.render().$el)})}}),ShowProjectView=Backbone.View.extend({initialize:function(a){this.bus=a.bus,this.bus.on("showProject",this.onShowProject,this),this.bus.on("showPrevProject",this.onShowPrevProject,this),this.bus.on("showNextProject",this.onShowNextProject,this),this.prevNextView=new PrevNextView({el:this.$el.find(".title-nav"),bus:this.bus}),this.footerPrevNext=new PrevNextView({el:this.$el.find(".footer"),bus:this.bus,prepend:1})},onShowProject:function(a){this.currProject=a,this.render(a),$(document).scrollTop(0)},navigate:function(a){var b=projects.indexOf(this.currProject)+a;b==projects.length?b=0:b<0&&(b=projects.length-1);var c=projects.at(b);router.navigate("projects/"+c.get("url")),this.onShowProject(c)},onShowNextProject:function(){this.navigate(1)},onShowPrevProject:function(){this.navigate(-1)},render:function(a){var b=_.template($("#showProjectTemplate").html()),c=$(b(a.toJSON())),d=c.find(".title"),e=c.find(".image"),f=c.find(".task"),g=c.find(".description");return this.$el.find(".title-nav").html(d),this.$el.find(".body").html(e),this.$el.find(".footer").html(""),this.$el.find(".footer").append(f),this.$el.find(".footer").append(g),this.prevNextView.render(),this.footerPrevNext.render(),this}}),PrevNextView=Backbone.View.extend({initialize:function(a){this.bus=a.bus,this.prepend=a.prepend},events:{"click .prev":"onPrevClick","click .next":"onNextClick"},onPrevClick:function(){this.bus.trigger("showPrevProject",this)},onNextClick:function(){this.bus.trigger("showNextProject",this)},render:function(){var a=_.template($("#prevNextTemplate").html());return this.prepend?this.$el.prepend(a):this.$el.append(a),this}}),HeaderNavView=Backbone.View.extend({initialize:function(a){this.bus=a.bus},events:{"click .nav-logo":"onProjectsClick","click .nav-project":"onProjectsClick","click .nav-about":"onAboutClick","click .menu-icon":"showDropMenu"},showDropMenu:function(){$(".menu-dropdown").toggleClass("showMenu")},onProjectsClick:function(a){a.preventDefault(),router.navigate("projects",{trigger:!0}),$(".menu-dropdown").toggleClass("showMenu")},onAboutClick:function(a){a.preventDefault(),router.navigate("about",{trigger:!0}),$(".menu-dropdown").toggleClass("showMenu")}}),projects=new Projects,eventBus=_.extend({},Backbone.Events),headerNavView=new HeaderNavView({el:".header-container",bus:eventBus}),dropMenuNavView=new HeaderNavView({el:".menu-dropdown",bus:eventBus}),AppRouter=Backbone.Router.extend({initialize:function(a){this.bus=a.bus},routes:{"":"viewHome",projects:"viewHome","projects/:projectId":"viewProjectById",about:"about","*other":"defaultRoute"},viewHome:function(){$("#projects").hide(),$("#thumbnails").show(),$("#about").hide()},viewProjectById:function(a){if($("#projects").show(),$("#thumbnails").show(),$("#about").hide(),projects.get(a)){var b=projects.get(a);this.bus.trigger("showProject",b)}else this.defaultRoute()},about:function(){$("#projects").hide(),$("#thumbnails").hide(),$("#about").show()},defaultRoute:function(){}}),router;projects.fetch({success:function(){var a=(new ShowProjectView({el:"#projects",bus:eventBus}),new ProjectsView({el:"#thumbnails",collection:projects,bus:eventBus}));a.render(),router=new AppRouter({bus:eventBus}),Backbone.history.start()}});